<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Editor Etiqueta</title>

  <!-- Hardening m√≠nimo (ideal: tambi√©n como headers en servidor) -->
  <meta http-equiv="Referrer-Policy" content="no-referrer" />
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="Permissions-Policy" content="geolocation=(), microphone=(), camera=()" />
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    base-uri 'none';
    object-src 'none';
    frame-ancestors 'none';
    script-src 'self' https://cdn.jsdelivr.net;
    style-src 'self' 'unsafe-inline';
    img-src 'self' data: blob:;
    connect-src 'self';
    font-src 'self';
    upgrade-insecure-requests;
  " />

  <link rel="stylesheet" href="./resource/css/styles.css" />

  <!-- ‚úÖ Exportar a PDF (jsPDF) -->
  <script src="./resource/vendor/jspdf.umd.min.js" defer></script>

  <!-- ‚úÖ Importar/Exportar Excel (SheetJS/xlsx) -->
  <script src="./resource/vendor/xlsx.full.min.js" defer></script>
</head>

<body>
  <h2>Editor de etiqueta</h2>

  <div class="wrap" id="workspace">
    <!-- IZQUIERDA -->
    <div class="card" id="leftCard">
      <!-- LISTA -->
      <div id="listView">
        <div class="cardHeader">
          <div>
            <h3 style="margin:0">Productos</h3>
           
          </div>

          <div class="btnRow" style="gap:8px">
            <button class="btnPrimary" id="btnShowForm" type="button">‚ûï Agregar</button>

            <!-- ‚úÖ Plantilla Excel -->
            <button class="btnIcon primary" id="btnTemplate" type="button" title="Descargar plantilla Excel" aria-label="Descargar plantilla Excel">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <path d="M7 10l5 5 5-5"/>
                <path d="M12 15V3"/>
              </svg>
            </button>

            <!-- ‚úÖ Importar Excel -->
            <button class="btnIcon primary" id="btnImport" type="button" title="Importar Excel" aria-label="Importar Excel">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <path d="M7 10l5-5 5 5"/>
                <path d="M12 5v14"/>
              </svg>
            </button>

            <button class="btnIcon primary" id="btnPdf" type="button" style="display:none" title="Exportar PDF" aria-label="Exportar PDF">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <path d="M14 2v6h6"/>
                <path d="M8 13h8"/>
                <path d="M8 17h5"/>
              </svg>
            </button>

            <button class="btnIcon success" id="btnPrint" type="button" style="display:none" title="Imprimir" aria-label="Imprimir">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 9V2h12v7"/>
                <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/>
                <path d="M6 14h12v8H6z"/>
              </svg>
            </button>

            <button class="btnIcon danger" id="btnResetAll" type="button" style="display:none" title="Limpiar todo" aria-label="Limpiar todo">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M7 21h10"/>
                <path d="M16 3l5 5-11 11H5L2 16 16 3z"/>
                <path d="M15 4l5 5"/>
              </svg>
            </button>
          </div>
        </div>

        <div class="leftScrollArea" id="listScrollArea">
          <div id="itemsWrap"></div>

         

        </div>
      </div>

      <!-- FORM -->
      <div id="formView" style="display:none">
        <div class="cardHeader">
          <div>
            <h3 id="formTitle" style="margin:0">Agregar producto</h3>
            <div class="subtle" id="formSubtitle">Completa todo para guardar</div>
          </div>
        </div>

        <div class="leftScrollArea" id="formScrollArea">
          <div class="form" id="formGrid">
            <div class="field">
              <label>Plantilla</label>
              <select id="fTemplate" required>
                <option value="" selected disabled>Selecciona una plantilla‚Ä¶</option>
                <option value="promocion1.svg">Promoci√≥n</option>
                <option value="normal1.svg">Normal</option>
                <option value="liquidacion1.svg">Liquidaci√≥n</option>
                <option value="oferta1.svg">Oferta</option>
              </select>
              <div class="fieldError" id="eTemplate"></div>
            </div>

            <div class="field">
              <label>Tama√±o</label>
              <select id="fSize" required>
                <option value="" selected disabled>Selecciona un tama√±o‚Ä¶</option>
                <option value="quarter">1/4 (4 por hoja)</option>
                <option value="half_h">Media hoja horizontal (2 por hoja)</option>
                <option value="full">Carta completa (1 por hoja)</option>
              </select>
              <div class="fieldError" id="eSize"></div>
            </div>

            <div class="field span2">
              <label>Nombre</label>
              <input id="fNombre" placeholder="Ej: Laptop color rojo y verde" autocomplete="off">
              <div class="fieldError" id="eNombre"></div>
            </div>

            <div class="field">
              <label>Antes (entero, m√°x 5 d√≠gitos)</label>
              <input id="fAntes" inputmode="numeric" pattern="[0-9]*" maxlength="5" placeholder="Ej: 39999" autocomplete="off">
              <div class="fieldError" id="eAntes"></div>
            </div>

            <div class="field">
              <label>Ahora (entero, m√°x 5 d√≠gitos)</label>
              <input id="fAhora" inputmode="numeric" pattern="[0-9]*" maxlength="5" placeholder="Ej: 29999" autocomplete="off">
              <div class="fieldError" id="eAhora"></div>
            </div>

            <div class="field span2">
              <label>Cuota (entero, m√°x 5 d√≠gitos)</label>
              <input id="fCuota" inputmode="numeric" pattern="[0-9]*" maxlength="5" placeholder="Ej: 19999" autocomplete="off">
              <div class="fieldError" id="eCuota"></div>
            </div>

            <div class="field">
              <label>Cantidad</label>
              <input id="fQty" type="number" min="1" step="1" value="1">
              <div class="fieldError" id="eQty"></div>
            </div>

            <div class="field">
              <label>Vigencia</label>
              <div class="toggleRow">
                <input id="fUseVig" type="checkbox">
                <div>
                  <span>Agregar fecha de vigencia</span>
                  <small>Si lo marcas, debes elegir inicio y fin</small>
                </div>
              </div>
              <div class="fieldError" id="eVig"></div>
            </div>

            <div class="field span2" id="vigDates" style="display:none">
              <div class="form" style="grid-template-columns:1fr 1fr; gap:10px">
                <div class="field">
                  <label>Fecha inicial</label>
                  <input id="fVigStart" type="date">
                  <div class="fieldError" id="eVigStart"></div>
                </div>
                <div class="field">
                  <label>Fecha final</label>
                  <input id="fVigEnd" type="date">
                  <div class="fieldError" id="eVigEnd"></div>
                </div>
              </div>
            </div>
          </div>

        
        </div>

        <div class="btnRow" style="margin-top:12px">
          <button class="btnSuccess" id="btnSave" type="button" disabled>üíæ Guardar</button>
          <button class="btnNeutral" id="btnCancel" type="button">‚Ü©Ô∏è Volver</button>
        </div>
      </div>
    </div>

    <!-- DERECHA -->
    <div class="card" id="paperPreviewWrap">
      <div id="paperPreview"></div>
    </div>
  </div>

  <div id="printRoot" style="display:none"></div>
  <canvas id="workCanvas"></canvas>
  <div id="__svgHostHidden"></div>

  <!-- Context menu -->
  <div id="ctxMenu" class="ctxMenu" role="menu" aria-hidden="true">
    <div class="ctxTop" id="ctxTop" style="--pairColor:#93c5fd">
      <div class="ctxDot" aria-hidden="true"></div>
      <div class="ctxTitle" id="ctxTitle">Producto</div>
    </div>
    <div class="ctxBtns">
      <button class="btnNeutral" id="ctxEdit" type="button">‚úèÔ∏è Editar</button>
      <button class="btnNeutral" id="ctxDelete" type="button" style="border-color:#fee2e2;color:#b91c1c;background:#fff">üóëÔ∏è Eliminar</button>
      <button class="btnNeutral" id="ctxClose" type="button">‚úñÔ∏è Cerrar</button>
    </div>
    <div class="ctxHint">Tip: click derecho en una etiqueta o producto.</div>
  </div>

  <!-- ‚úÖ Modal -->
  <div class="modalOverlay" id="modalOverlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <div class="modalHead">
        <h4 id="modalTitle">T√≠tulo</h4>
        <button class="btnIcon" id="modalX" type="button" title="Cerrar" aria-label="Cerrar">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18"/><path d="M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="modalBody" id="modalBody"></div>
      <div class="modalActions" id="modalActions"></div>
    </div>
  </div>

  <!-- ‚úÖ Input archivo -->
  <input id="fileImport" type="file" accept=".xlsx,.xls" style="display:none">

  <script type="module" src="./src/main.js"></script>
</body>
</html>
